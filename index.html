<!DOCTYPE html>
<html lang="en">
<title>My Probabalistic Program Will Pierce the Heavens</title>
<link rel = "icon" type="image/jpg" href="./images/logo.png"/>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1">
<link rel="stylesheet" href="https://www.w3schools.com/w3css/4/w3.css">
<link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Poppins">
<head>
  <script src="https://unpkg.com/bson@2.0.8/browser_build/bson.js"></script>
  <script src="https://cdn.jsdelivr.net/npm/@tensorflow/tfjs@2.0.0/dist/tf.min.js"></script>
  <script src="https://d3js.org/d3.v6.min.js"></script>
  <script src="https://cdn.plot.ly/plotly-latest.min.js"></script>
  <script src="https://unpkg.com/vue@next"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega@5"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-lite@4"></script>
  <script src="https://cdn.jsdelivr.net/npm/vega-embed@6"></script>

  <script>
    flux = (function () {

let Buffer = new BSON().serialize({}).constructor

function blobAsArrayBuffer(blob) {
  return new Promise((resolve, reject) => {
    let reader = new FileReader();
    reader.addEventListener("loadend", function() {
      resolve(reader.result);
    });
    reader.readAsArrayBuffer(blob);
  });
}

async function fetchBytes(url) {
  let resp = await fetch(url);
  if (!resp.ok) throw(resp);
  let blob = await resp.blob();
  let buf  = await blobAsArrayBuffer(blob);
  return new Buffer(buf);
}

async function fetchData(url) {
  let buf = await fetchBytes(url);
  return new BSON().deserialize(buf);
}

// `buf` is a Uint8Array from BSON
function readFloat32(buf) {
  let view = new DataView(buf.buffer, buf.byteOffset, buf.byteLength);
  let data = new Float32Array(view.byteLength/4);
  for (let i = 0; i < data.length; i++) {
    data[i] = view.getFloat32(i*4, true);
  }
  return data;
}

function readInt32(buf) {
  let view = new DataView(buf.buffer, buf.byteOffset, buf.byteLength);
  let data = new Int32Array(view.byteLength/4);
  for (let i = 0; i < data.length; i++) {
    data[i] = view.getInt32(i*4, true);
  }
  return data;
}

function toTensor_(spec) {
  let type = spec.type.name;
  type = type[type.length-1];
  if (type == 'Float32') spec.data = readFloat32(spec.data.buffer);
  else if (type == 'Int32') spec.data = readInt32(spec.data.buffer);
  else throw `Array type ${spec.type.name} not supported.`;
  let array = tf.tensor(spec.data, spec.size.reverse());
  return array
}

function convertArrays_(data) {
  if (!(typeof data == "object")) return data
  if (data.tag == "array") {
    return toTensor_(data);
  } else {
    for (let k of Object.keys(data)) {
      data[k] = convertArrays_(data[k])
    }
  }
  return data;
}

async function fetchBlob(url) {
  data = await fetchData(url);
  return convertArrays_(data)
}

async function fetchWeights(url) {
  ws = await fetchBlob(url);
  return ws.weights;
}

const _data = t => (t instanceof tf.Tensor)? t.dataSync(): t;
const slice = t => (t instanceof tf.Tensor)? t.clone():(
  t instanceof Array ? t.slice() : t);

return {fetchData, fetchWeights, fetchBlob, data: _data, slice, convertArrays_};

})();
  </script>
</head>

<style>
body,h1,h2,h3,h4,h5 {font-family: "Poppins", sans-serif}
body {font-size:16px;}
.w3-half img{margin-bottom:-6px;margin-top:16px;opacity:0.8;cursor:pointer}
.w3-half img:hover{opacity:1}
</style>
<body>

<!-- Sidebar/menu -->
<nav class="w3-sidebar w3-light-green w3-collapse w3-top w3-large w3-padding" style="z-index:3;width:300px;font-weight:bold;" id="mySidebar"><br>
  <a href="javascript:void(0)" onclick="w3_close()" class="w3-button w3-hide-large w3-display-topleft w3-padding" style="width:100%;font-size:22px">Close Menu</a>
  <div class="w3-container">
    <img src="./images/logo.png" alt="logo" style="width:70%">
    <h3 class="w3-padding-64"><b>Mean<br>Median<br>and Mood</b></h3>
  </div>
  <div class="w3-bar-block">
    <a href="#" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-white">Home</a> 
    <a href="#graphgallery" onclick="w3_close()" class="w3-bar-item w3-button w3-hover-white">Useless Graphs</a> 
  </div>
</nav>

<!-- Top menu on small screens -->
<header class="w3-container w3-top w3-hide-large w3-light-green w3-xlarge w3-padding">
  <a href="javascript:void(0)" class="w3-button w3-light-green w3-margin-right" onclick="w3_open()">â˜°</a>
  <span>Mean, Median, and Mood</span>
</header>

<!-- Overlay effect when opening sidebar on small screens -->
<div class="w3-overlay w3-hide-large" onclick="w3_close()" style="cursor:pointer" title="close side menu" id="myOverlay"></div>

<!-- !PAGE CONTENT! -->
<div class="w3-main" style="margin-left:340px;margin-right:40px">

  <!-- Header -->
  <div class="w3-container" style="margin-top:80px" id="showcase">
    <h1 class="w3-mobile w3-jumbo"><b>Better than Spreadsheets</b></h1>
    <h1 class="w3-xxxlarge w3-text-light-green"><b>What's this?</b></h1>
    <hr style="width:50px;border:5px solid black" class="w3-round">
    <p>
    Welcome to Mean, Median and Mood: a not-so-well-curated collection of statistical musings from a multi-racial 
    American stuck in his parent's house during a pandemic. 
    </p>
  </div>
  
  <!-- Services -->
  <div class="w3-container" id="graphgallery" style="margin-top:75px">
    <h1 class="w3-xxxlarge w3-text-light-green"><b>Useless Graphs</b></h1>
    <hr style="width:50px;border:5px solid black" class="w3-round">
    <p>I've always loved meeting artists and marveling at the works they create. Whenever I've put pen to paper, though, it doesn't usually hold up. So, I got creative.</p>
    <p> Inspired by <a href="https://vega.github.io/vega-lite/examples/arc_pie_pyramid.html">this pie chart</a>, originally done in SAS, I've decided to try and create art using the only medium where I stand a chance.
        Here you'll find a collection of fun-looking graphs. I've tried to get creative with these, both in how they look and how they're made. I plan to use a variety of
        plotting packages to make them. Some are specified entirely in the front-end, others are made on the server and then have their json specs  shot across the interwebs,
        and some are just hosted as static images. All of them are useless statistically. Libraries include Vega, Vega-Lite, Ploty.js, PlotlyJS.jl, Makie.jl, and D3.js.  
    </p>
  </div>

  <div class="w3-row-padding w3-grayscale">
    <div class="w3-col m4 w3-margin-bottom">
      <div class="w3-lcontainer">
        <div id = "pad1" style = "width:100%"></div>
      </div>
    </div>
    <div class="w3-col m4 w3-margin-bottom">
      <div class="w3-lcontainer">
        <div id = "graph1" style = "width:100%"></div>
      </div>
    </div>
    <div class="w3-col m4 w3-margin-bottom">
      <div class="w3-lcontainer">
        <div id = "pad2" style = "width:100%"></div>
      </div>
    </div>
  </div>

  <div class="w3-row-padding w3-grayscale">
    <div class="w3-col m4 w3-margin-bottom">
      <div class="w3-lcontainer">
        <div id = "pad1" style = "width:100%"></div>
      </div>
    </div>
    <div class="w3-col m4 w3-margin-bottom">
      <div class="w3-lcontainer">
        <div id = "graph2" style = "width:100%"></div>
      </div>
    </div>
    <div class="w3-col m4 w3-margin-bottom">
      <div class="w3-lcontainer">
        <div id = "pad2" style = "width:100%"></div>
      </div>
    </div>
  </div>

</div>

<!-- W3.CSS Container -->
<div class="w3-light-grey w3-container w3-padding-32" style="margin-top:75px;padding-right:58px"><p class="w3-right">Powered by <a href="https://www.w3schools.com/w3css/default.asp" title="W3.CSS" target="_blank" class="w3-hover-opacity">w3.css</a></p></div>

<script>
// Script to open and close sidebar
function w3_open() {
  document.getElementById("mySidebar").style.display = "block";
  document.getElementById("myOverlay").style.display = "block";
}

function w3_close() {
  document.getElementById("mySidebar").style.display = "none";
  document.getElementById("myOverlay").style.display = "none";
}

// Modal Image Gallery
function onClick(element) {
  document.getElementById("img01").src = element.src;
  document.getElementById("modal01").style.display = "block";
  var captionText = document.getElementById("caption");
  captionText.innerHTML = element.alt;
}



</script>
<script>
  let model = (function () {
    let math = tf;
    function model(kinkajou) {
      return kinkajou;
    };
    model.weights = [];
    return model;
  })();
  flux.fetchWeights("./bnn/mymodel.bson").then((function (ws) {
    return model.weights = ws;
  }));
  </script>
<script src="./plots/src/waka.js"></script>
<script src="./plots/src/creepy.js"> </script> 
<script src="./plots/src/race.js"> </script> 
</body>
</html>
